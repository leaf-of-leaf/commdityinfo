<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Please sign in</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/4.0/examples/signin/signin.css" rel="stylesheet" crossorigin="anonymous"/>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
</head>
<body>
<div class="container">
<!--    <form class="form-signin">-->
        <h2 class="form-signin-heading">请登录</h2>
        <p>
            <label for="username" class="sr-only">Username</label>
            <input type="text" id="username" name="username" class="form-control" placeholder="Username" autofocus>
        </p>
        <p>
            <label for="password" class="sr-only">Password</label>
            <input type="password" id="password" name="password" class="form-control" placeholder="Password">
        </p>
        <p>
            <label class="sr-only">code</label>
            <input type="text" name="ImageCode" class="form-control" placeholder="Code">
            <img src="/code/img" width="50%">
        </p>
        <input type="checkbox" name="remember-me"/> 记住我
        <input name="_csrf" type="hidden" value="e1e3db85-9e4c-4dcb-82b4-865aff7410b2" />
        <button name="loginBtn" class="loginBtn btn btn-lg btn-primary btn-block" type="submit">Sign in</button>
<!--    </form>-->
    <br>
    <br>
<!--    <form class="login-page" action="/login/mobile" method="post">-->
        <div class="form">
            <h3>短信验证码登录</h3>
            <input id="phone" type="text" placeholder="手机号" name="mobile" value="15115571837"/>
            <span style="display: inline">
            <input id="phoneCode" type="text" name="smsCode" placeholder="短信验证码" style="width: 50%;"/>
            <button class="btn primary sendsms" >发送验证码</button>
        </span>
            <button class="loginPhoneBtn btn btn-lg btn-primary btn-block" type="submit">登录</button>
        </div>
<!--    </form>-->
</div>
<script>
    $.ajaxPrefilter(function( options, originalOptions, jqXHR ) {
        options.xhrFields = {
            withCredentials: true
        }
    });

    $(function () {
        $('.sendsms').click(function(){
            var phone = $('#phone').val();
            alert(phone)
            $.get('/code/sms', {phone:phone},function (res) {
                alert(res.message);
            })
        })

        $(".loginPhoneBtn").click(function () {
            var phoneCode = $('#phoneCode').val();
            var phone = $('#phone').val();
            var path = "/login/mobile";

            $.post(path, {phone:phone,phoneCode:phoneCode}, function (data,status,xhr) {
                if(status == "success"){
                    var local = window.localStorage;
                    var authorization = xhr.getResponseHeader("Authorization");
                    local.setItem("authorization", authorization);
                    alert(window.localStorage.getItem("authorization"));
                }
            })

        })
        $(".loginBtn").click(function () {
            var username = $("input[name='username']").val();
            var password = $("input[name='password']").val();
            var ImageCode = $("input[name='ImageCode']").val();
            var path = "/login";

            $.post(path, {username:username,password:password,ImageCode:ImageCode}, function (data,status,xhr) {
                if(status == "success"){
                    var local = window.localStorage;
                    var authorization = xhr.getResponseHeader("Authorization");
                    local.setItem("authorization", authorization);
                    alert(window.localStorage.getItem("authorization"));
                }
            })
        })
    })

</script>
</body>
</html>